"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const React = require("react");
// Typescript wont let us just grab individual lodash modules using a
// normal `import first from 'lodash/first'` statement, but this works
// to avoid bloat.
const first = require("lodash/first");
const find = require("lodash/find");
const last = require("lodash/last");
const { createFragmentContainer, graphql } = require('react-relay');
class StatsChange extends React.Component {
    render() {
        const start = first(this.props.snapshots);
        const end = last(this.props.snapshots);
        const startCount = start != null
            ? [start.views, start.likes, start.dislikes, start.favorites,
                start.comments]
                .map(Number).reduce((sum, num) => sum + num, 0)
            : 0;
        const endCount = end != null
            ? [end.views, end.likes, end.dislikes, end.favorites, end.comments]
                .map(Number).reduce((sum, num) => sum + num, 0)
            : 0;
        const change = endCount - startCount;
        const percent = Math.round((endCount / startCount * 100) - 100) || 0;
        const diff = Math.abs(change);
        const sign = change > 0 ? '+' : change < 0 ? '-' : '';
        const signClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'none';
        const s = suffixNumber;
        const f = formatNumber;
        const className = `stats-change ${signClass}`;
        return (React.createElement("div", { className: className },
            React.createElement("span", { className: "start-end" },
                React.createElement("span", { className: "start" }, s(startCount)),
                React.createElement("span", { className: "separator" }, "\u25BA"),
                React.createElement("span", { className: "end" }, s(endCount))),
            React.createElement("span", { className: "diff" },
                React.createElement("span", { className: "sign" }, sign),
                React.createElement("span", { className: "count" }, s(diff)),
                React.createElement("span", { className: "separator" }, "/"),
                React.createElement("span", { className: "percent" },
                    React.createElement("em", null, f(percent)),
                    "%"))));
    }
}
function formatNumber(number) {
    if (Math.abs(number) >= 10)
        return Math.round(number)
            .toString().split('').reverse()
            .map((num, nx) => (nx + 1) % 3 === 0 ? ',' + num : num)
            .reverse().join('').replace(/^,/, '');
    const [whole, partial = null] = number.toString().split('.');
    if (partial === null)
        return whole;
    const decimal = Math.floor(Number(partial) / (Math.pow(10, (partial.length - 1)))).toString();
    return whole + '.' + decimal;
}
function suffixNumber(number) {
    const suffixes = [
        ['K', 1000], ['M', 1000000], ['B', 1000000000], ['T', 1000000000000]
    ].reverse();
    const [suffix = '', divisor = 1] = find(suffixes, ([_, divisor]) => {
        return (number / divisor) >= 1;
    });
    const reduced = number / divisor;
    return `${formatNumber(reduced)}${suffix}`;
}
exports.default = createFragmentContainer(StatsChange, graphql `
	fragment StatsChange_snapshots on VideoStats @relay(plural: true) {
		views
		likes
		dislikes
		favorites
		comments
	}
`);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhdHNDaGFuZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9TdGF0c0NoYW5nZS50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSwrQkFBOEI7QUFFOUIscUVBQXFFO0FBQ3JFLHNFQUFzRTtBQUN0RSxrQkFBa0I7QUFDbEIsc0NBQXNDO0FBQ3RDLG9DQUFvQztBQUNwQyxvQ0FBb0M7QUFFcEMsTUFBTSxFQUFFLHVCQUF1QixFQUFFLE9BQU8sRUFBRSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQTtBQWNuRSxpQkFBa0IsU0FBUSxLQUFLLENBQUMsU0FBZ0M7SUFFL0QsTUFBTTtRQUNMLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQ3pDLE1BQU0sR0FBRyxHQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBRXZDLE1BQU0sVUFBVSxHQUFHLEtBQUssSUFBSSxJQUFJO2NBQzdCLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLFNBQVM7Z0JBQzFELEtBQUssQ0FBQyxRQUFRLENBQUM7aUJBQ2YsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEtBQUssR0FBRyxHQUFHLEdBQUcsRUFBRSxDQUFDLENBQUM7Y0FDOUMsQ0FBQyxDQUFBO1FBQ0osTUFBTSxRQUFRLEdBQUcsR0FBRyxJQUFJLElBQUk7Y0FDekIsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUM7aUJBQ2pFLEdBQUcsQ0FBQyxNQUFNLENBQUMs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R0FBRyxHQUFHLEdBQUcsT0FBTyxDQUFBO0FBQzdCLENBQUM7QUFFRCxzQkFBc0IsTUFBYztJQUNuQyxNQUFNLFFBQVEsR0FBRztRQUNoQixDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxhQUFhLENBQUM7S0FDcEUsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUVYLE1BQU0sQ0FBQyxNQUFNLEdBQUMsRUFBRSxFQUFFLE9BQU8sR0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDO1FBQzFELE1BQU0sQ0FBQyxDQUFDLE1BQU0sR0FBSSxPQUFrQixDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzNDLENBQUMsQ0FBcUIsQ0FBQTtJQUV0QixNQUFNLE9BQU8sR0FBRyxNQUFNLEdBQUcsT0FBTyxDQUFBO0lBQ2hDLE1BQU0sQ0FBQyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsR0FBRyxNQUFNLEVBQUUsQ0FBQTtBQUMzQyxDQUFDO0FBR0Qsa0JBQWUsdUJBQXVCLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQTs7Ozs7Ozs7Q0FRMUQsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCdcblxuLy8gVHlwZXNjcmlwdCB3b250IGxldCB1cyBqdXN0IGdyYWIgaW5kaXZpZHVhbCBsb2Rhc2ggbW9kdWxlcyB1c2luZyBhXG4vLyBub3JtYWwgYGltcG9ydCBmaXJzdCBmcm9tICdsb2Rhc2gvZmlyc3QnYCBzdGF0ZW1lbnQsIGJ1dCB0aGlzIHdvcmtzXG4vLyB0byBhdm9pZCBibG9hdC5cbmltcG9ydCBmaXJzdCA9IHJlcXVpcmUoJ2xvZGFzaC9maXJzdCcpXG5pbXBvcnQgZmluZCA9IHJlcXVpcmUoJ2xvZGFzaC9maW5kJylcbmltcG9ydCBsYXN0ID0gcmVxdWlyZSgnbG9kYXNoL2xhc3QnKVxuXG5jb25zdCB7IGNyZWF0ZUZyYWdtZW50Q29udGFpbmVyLCBncmFwaHFsIH0gPSByZXF1aXJlKCdyZWFjdC1yZWxheScpXG5cblxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRzQ2hhbmdlUHJvcHMge1xuXHRzbmFwc2hvdHM6IHtcblx0XHR2aWV3czogc3RyaW5nLFxuXHRcdGxpa2VzOiBzdHJpbmcsXG5cdFx0ZGlzbGlrZXM6IHN0cmluZyxcblx0XHRmYXZvcml0ZXM6IHN0cmluZyxcblx0XHRjb21tZW50czogc3RyaW5nLFxuXHR9W11cbn1cblxuY2xhc3MgU3RhdHNDaGFuZ2UgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8U3RhdHNDaGFuZ2VQcm9wcywgYW55PiB7XG5cblx0cmVuZGVyKCkge1xuXHRcdGNvbnN0IHN0YXJ0ID0gZmlyc3QodGhpcy5wcm9wcy5zbmFwc2hvdHMpXG5cdFx0Y29uc3QgZW5kICA9IGxhc3QodGhpcy5wcm9wcy5zbmFwc2hvdHMpXG5cblx0XHRjb25zdCBzdGFydENvdW50ID0gc3RhcnQgIT0gbnVsbFxuXHRcdFx0PyBbc3RhcnQudmlld3MsIHN0YXJ0Lmxpa2VzLCBzdGFydC5kaXNsaWtlcywgc3RhcnQuZmF2b3JpdGVzLFxuXHRcdFx0XHQgc3RhcnQuY29tbWVudHNdXG5cdFx0XHRcdC5tYXAoTnVtYmVyKS5yZWR1Y2UoKHN1bSwgbnVtKSA9PiBzdW0gKyBudW0sIDApXG5cdFx0XHQ6IDBcblx0XHRjb25zdCBlbmRDb3VudCA9IGVuZCAhPSBudWxsXG5cdFx0XHQ/IFtlbmQudmlld3MsIGVuZC5saWtlcywgZW5kLmRpc2xpa2VzLCBlbmQuZmF2b3JpdGVzLCBlbmQuY29tbWVudHNdXG5cdFx0XHRcdC5tYXAoTnVtYmVyKS5yZWR1Y2UoKHN1bSwgbnVtKSA9PiBzdW0gKyBudW0sIDApXG5cdFx0XHQ6IDBcblxuXHRcdGNvbnN0IGNoYW5nZSAgPSBlbmRDb3VudCAtIHN0YXJ0Q291bnRcblx0XHRjb25zdCBwZXJjZW50ID0gTWF0aC5yb3VuZCgoZW5kQ291bnQgLyBzdGFydENvdW50ICogMTAwKSAtIDEwMCkgfHwgMFxuXHRcdGNvbnN0IGRpZmYgICAgPSBNYXRoLmFicyhjaGFuZ2UpXG5cdFx0Y29uc3Qgc2lnbiA9IGNoYW5nZSA+IDAgPyAnKycgOiBjaGFuZ2UgPCAwID8gJy0nIDogJydcblx0XHRjb25zdCBzaWduQ2xhc3MgPSBjaGFuZ2UgPiAwID8gJ3Bvc2l0aXZlJyA6IGNoYW5nZSA8IDAgPyAnbmVnYXRpdmUnIDogJ25vbmUnXG5cblx0XHRjb25zdCBzID0gc3VmZml4TnVtYmVyXG5cdFx0Y29uc3QgZiA9IGZvcm1hdE51bWJlclxuXHRcdGNvbnN0IGNsYXNzTmFtZSA9IGBzdGF0cy1jaGFuZ2UgJHtzaWduQ2xhc3N9YFxuXG5cdFx0cmV0dXJuIChcblx0XHRcdDxkaXYgY2xhc3NOYW1lPXtjbGFzc05hbWV9PlxuXHRcdFx0XHQ8c3BhbiBjbGFzc05hbWU9XCJzdGFydC1lbmRcIj5cblx0XHRcdFx0XHQ8c3BhbiBjbGFzc05hbWU9XCJzdGFydFwiPntzKHN0YXJ0Q291bnQgYXMgbnVtYmVyKX08L3NwYW4+XG5cdFx0XHRcdFx0PHNwYW4gY2xhc3NOYW1lPVwic2VwYXJhdG9yXCI+4pa6PC9zcGFuPlxuXHRcdFx0XHRcdDxzcGFuIGNsYXNzTmFtZT1cImVuZFwiPntzKGVuZENvdW50IGFzIG51bWJlcil9PC9zcGFuPlxuXHRcdFx0XHQ8L3NwYW4+XG5cdFx0XHRcdDxzcGFuIGNsYXNzTmFtZT1cImRpZmZcIj5cblx0XHRcdFx0XHQ8c3BhbiBjbGFzc05hbWU9XCJzaWduXCI+e3NpZ259PC9zcGFuPlxuXHRcdFx0XHRcdDxzcGFuIGNsYXNzTmFtZT1cImNvdW50XCI+e3MoZGlmZil9PC9zcGFuPlxuXHRcdFx0XHRcdDxzcGFuIGNsYXNzTmFtZT1cInNlcGFyYXRvclwiPi88L3NwYW4+XG5cdFx0XHRcdFx0PHNwYW4gY2xhc3NOYW1lPVwicGVyY2VudFwiPjxlbT57ZihwZXJjZW50KX08L2VtPiU8L3NwYW4+XG5cdFx0XHRcdDwvc3Bhbj5cblx0XHRcdDwvZGl2PlxuXHRcdClcblx0fVxufVxuXG5mdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyOiBudW1iZXIpOiBzdHJpbmcge1xuXHRpZiAoTWF0aC5hYnMobnVtYmVyKSA+PSAxMClcblx0XHRyZXR1cm4gTWF0aC5yb3VuZChudW1iZXIpXG5cdFx0XHQudG9TdHJpbmcoKS5zcGxpdCgnJykucmV2ZXJzZSgpXG5cdFx0XHQubWFwKChudW0sIG54KSA9PiAobngrMSkgJSAzID09PSAwID8gJywnK251bSA6IG51bSlcblx0XHRcdC5yZXZlcnNlKCkuam9pbignJykucmVwbGFjZSgvXiwvLCAnJylcblxuXHRjb25zdCBbd2hvbGUsIHBhcnRpYWw9bnVsbF0gPSBudW1iZXIudG9TdHJpbmcoKS5zcGxpdCgnLicpXG5cblx0aWYgKHBhcnRpYWwgPT09IG51bGwpXG5cdFx0cmV0dXJuIHdob2xlXG5cblx0Y29uc3QgZGVjaW1hbCA9IE1hdGguZmxvb3IoXG5cdFx0TnVtYmVyKHBhcnRpYWwpIC8gKDEwICoqIChwYXJ0aWFsLmxlbmd0aCAtIDEpKVxuXHQpLnRvU3RyaW5nKClcblxuXHRyZXR1cm4gd2hvbGUgKyAnLicgKyBkZWNpbWFsXG59XG5cbmZ1bmN0aW9uIHN1ZmZpeE51bWJlcihudW1iZXI6IG51bWJlcik6IHN0cmluZyB7XG5cdGNvbnN0IHN1ZmZpeGVzID0gW1xuXHRcdFsnSycsIDEwMDBdLCBbJ00nLCAxMDAwMDAwXSwgWydCJywgMTAwMDAwMDAwMF0sIFsnVCcsIDEwMDAwMDAwMDAwMDBdXG5cdF0ucmV2ZXJzZSgpXG5cblx0Y29uc3QgW3N1ZmZpeD0nJywgZGl2aXNvcj0xXSA9IGZpbmQoc3VmZml4ZXMsIChbXywgZGl2aXNvcl0pID0+IHtcblx0XHRyZXR1cm4gKG51bWJlciAvIChkaXZpc29yIGFzIG51bWJlcikpID49IDFcblx0fSkgYXMgW3N0cmluZywgbnVtYmVyXVxuXG5cdGNvbnN0IHJlZHVjZWQgPSBudW1iZXIgLyBkaXZpc29yXG5cdHJldHVybiBgJHtmb3JtYXROdW1iZXIocmVkdWNlZCl9JHtzdWZmaXh9YFxufVxuXG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZUZyYWdtZW50Q29udGFpbmVyKFN0YXRzQ2hhbmdlLCBncmFwaHFsYFxuXHRmcmFnbWVudCBTdGF0c0NoYW5nZV9zbmFwc2hvdHMgb24gVmlkZW9TdGF0cyBAcmVsYXkocGx1cmFsOiB0cnVlKSB7XG5cdFx0dmlld3Ncblx0XHRsaWtlc1xuXHRcdGRpc2xpa2VzXG5cdFx0ZmF2b3JpdGVzXG5cdFx0Y29tbWVudHNcblx0fVxuYClcbiJdfQ==