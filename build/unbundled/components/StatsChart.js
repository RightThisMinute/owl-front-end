"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const React = require("react");
const react_chartjs_2_1 = require("react-chartjs-2");
const { createFragmentContainer, graphql } = require('react-relay');
const CHART_OPTS = {
    responsive: true,
    legend: { display: false },
    scales: {
        xAxes: [{
                display: false,
                gridLines: { display: false },
            }],
        yAxes: [{
                display: false,
                stacked: true,
                ticks: { display: false },
                gridLines: { display: false },
            }],
        gridLines: { display: false },
    },
};
class StatsChart extends React.Component {
    render() {
        const { data } = this;
        const totals = data.datasets.reduce((accl, { data }) => {
            data.forEach((value, index) => {
                accl[index] = (accl[index] || 0) + value;
            });
            return accl;
        }, []);
        const min = Math.min(...totals);
        let max = Math.max(...totals);
        // Prevent small changes appearing the same as big changes.
        const { scale } = this.props;
        if (max < scale * min)
            max = (scale * min);
        const yAxes = CHART_OPTS.scales.yAxes.map(axis => {
            return Object.assign({}, axis, {
                ticks: {
                    min, max,
                    beginAtZero: false,
                },
            });
        });
        const scales = Object.assign({}, CHART_OPTS.scales, {
            yAxes,
        });
        const opts = Object.assign({}, CHART_OPTS, { scales });
        return (React.createElement("div", { className: "chart-box" },
            React.createElement(react_chartjs_2_1.Line, { data: data, options: opts })));
    }
    get data() {
        const labels = [];
        let datasets = [
            { label: 'views', borderColor: '#777', },
            { label: 'dislikes', borderColor: '#999', },
            { label: 'likes', borderColor: '#bbb', },
            { label: 'comments', borderColor: '#555', },
            { label: 'favorites', borderColor: '#333', },
        ];
        datasets = datasets.map(dataset => {
            dataset.backgroundColor = dataset.backgroundColor || dataset.borderColor;
            dataset.data = [];
            dataset.pointRadius = 1;
            return dataset;
        });
        let count = 0;
        this.props.snapshots.forEach(snapshot => {
            labels.push(`${count++}`);
            datasets.forEach(({ label = '[ERROR]', data = [] }) => {
                data.push(Number(snapshot[label]));
            });
        });
        const maxCount = 1;
        return { labels, datasets };
    }
}
exports.default = createFragmentContainer(StatsChart, graphql `
	fragment StatsChart_snapshots on VideoStats @relay(plural: true) {
		views
		likes
		dislikes
		favorites
		comments
	}
`);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhdHNDaGFydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1N0YXRzQ2hhcnQudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsK0JBQThCO0FBRTlCLHFEQUFzQztBQUV0QyxNQUFNLEVBQUUsdUJBQXVCLEVBQUUsT0FBTyxFQUFFLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFBO0FBaUJuRSxNQUFNLFVBQVUsR0FBaUI7SUFDaEMsVUFBVSxFQUFFLElBQUk7SUFDaEIsTUFBTSxFQUFFLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRTtJQUMxQixNQUFNLEVBQUU7UUFDUCxLQUFLLEVBQUUsQ0FBQztnQkFDUCxPQUFPLEVBQUUsS0FBSztnQkFDZCxTQUFTLEVBQUUsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFO2FBQzdCLENBQUM7UUFDRixLQUFLLEVBQUUsQ0FBQztnQkFDUCxPQUFPLEVBQUUsS0FBSztnQkFDZCxPQUFPLEVBQUUsSUFBSTtnQkFDYixLQUFLLEVBQUUsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFO2dCQUN6QixTQUFTLEVBQUUsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFO2FBQzdCLENBQUM7UUFDRixTQUFTLEVBQUUsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFO0tBQzdCO0NBQ0QsQ0FBQTtBQUVELGdCQUFpQixTQUFRLEtBQUssQ0FBQyxTQUFxQjtJQUVuRCxNQUFNO1FBQ0wsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQTtRQUVyQixNQUFNLE1BQU0sR0FBSSxJQUFJLENBQUMsUUFBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQWMsRUFBRSxFQUFFLElBQUksRUFBRTtZQUM3RCxJQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxLQUFLO2dCQUN2QyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElB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QUFBO1FBRUYsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFBO1FBRWxCLE1BQU0sQ0FBQyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsQ0FBQTtJQUM1QixDQUFDO0NBQ0Q7QUFHRCxrQkFBZSx1QkFBdUIsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFBOzs7Ozs7OztDQVF6RCxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgQ2hhcnREYXRhLCBDaGFydERhdGFTZXRzLCBDaGFydE9wdGlvbnMgfSBmcm9tICdjaGFydC5qcydcbmltcG9ydCB7IExpbmUgfSBmcm9tICdyZWFjdC1jaGFydGpzLTInXG5cbmNvbnN0IHsgY3JlYXRlRnJhZ21lbnRDb250YWluZXIsIGdyYXBocWwgfSA9IHJlcXVpcmUoJ3JlYWN0LXJlbGF5JylcblxuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRzQ2hhcnRQcm9wcyB7XG5cdHNuYXBzaG90czoge1xuXHRcdHZpZXdzOiBzdHJpbmcsXG5cdFx0bGlrZXM6IHN0cmluZyxcblx0XHRkaXNsaWtlczogc3RyaW5nLFxuXHRcdGZhdm9yaXRlczogc3RyaW5nLFxuXHRcdGNvbW1lbnRzOiBzdHJpbmcsXG5cdH1bXVxufVxuXG5pbnRlcmZhY2UgUHJvcHMgZXh0ZW5kcyBTdGF0c0NoYXJ0UHJvcHMge1xuXHRzY2FsZTogbnVtYmVyXG59XG5cbmNvbnN0IENIQVJUX09QVFM6IENoYXJ0T3B0aW9ucyA9IHtcblx0cmVzcG9uc2l2ZTogdHJ1ZSxcblx0bGVnZW5kOiB7IGRpc3BsYXk6IGZhbHNlIH0sXG5cdHNjYWxlczoge1xuXHRcdHhBeGVzOiBbe1xuXHRcdFx0ZGlzcGxheTogZmFsc2UsXG5cdFx0XHRncmlkTGluZXM6IHsgZGlzcGxheTogZmFsc2UgfSxcblx0XHR9XSxcblx0XHR5QXhlczogW3tcblx0XHRcdGRpc3BsYXk6IGZhbHNlLFxuXHRcdFx0c3RhY2tlZDogdHJ1ZSxcblx0XHRcdHRpY2tzOiB7IGRpc3BsYXk6IGZhbHNlIH0sXG5cdFx0XHRncmlkTGluZXM6IHsgZGlzcGxheTogZmFsc2UgfSxcblx0XHR9XSxcblx0XHRncmlkTGluZXM6IHsgZGlzcGxheTogZmFsc2UgfSxcblx0fSxcbn1cblxuY2xhc3MgU3RhdHNDaGFydCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxQcm9wcywgYW55PiB7XG5cblx0cmVuZGVyKCkge1xuXHRcdGNvbnN0IHsgZGF0YSB9ID0gdGhpc1xuXG5cdFx0Y29uc3QgdG90YWxzICA9IGRhdGEuZGF0YXNldHMhLnJlZHVjZSgoYWNjbDogbnVtYmVyW10sIHsgZGF0YSB9KSA9PiB7XG5cdFx0XHQoZGF0YSBhcyBudW1iZXJbXSkuZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7XG5cdFx0XHRcdGFjY2xbaW5kZXhdID0gKGFjY2xbaW5kZXhdIHx8IDApICsgdmFsdWVcblx0XHRcdH0pXG5cdFx0XHRyZXR1cm4gYWNjbFxuXHRcdH0sIFtdKVxuXG5cdFx0Y29uc3QgbWluID0gTWF0aC5taW4oLi4udG90YWxzKVxuXHRcdCAgbGV0IG1heCA9IE1hdGgubWF4KC4uLnRvdGFscylcblxuXHRcdC8vIFByZXZlbnQgc21hbGwgY2hhbmdlcyBhcHBlYXJpbmcgdGhlIHNhbWUgYXMgYmlnIGNoYW5nZXMuXG5cdFx0Y29uc3QgeyBzY2FsZSB9ID0gdGhpcy5wcm9wc1xuXHRcdGlmIChtYXggPCBzY2FsZSptaW4pXG5cdFx0XHRtYXggPSAoc2NhbGUqbWluKVxuXG5cdFx0Y29uc3QgeUF4ZXMgPSBDSEFSVF9PUFRTLnNjYWxlcyEueUF4ZXMhLm1hcChheGlzID0+IHtcblx0XHRcdHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBheGlzLCB7XG5cdFx0XHRcdHRpY2tzOiB7XG5cdFx0XHRcdFx0bWluLCBtYXgsXG5cdFx0XHRcdFx0YmVnaW5BdFplcm86IGZhbHNlLFxuXHRcdFx0XHR9LFxuXHRcdFx0fSlcblx0XHR9KVxuXG5cdFx0Y29uc3Qgc2NhbGVzID0gT2JqZWN0LmFzc2lnbih7fSwgQ0hBUlRfT1BUUy5zY2FsZXMsIHtcblx0XHRcdHlBeGVzLFxuXHRcdH0pXG5cblx0XHRjb25zdCBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwgQ0hBUlRfT1BUUywgeyBzY2FsZXMgfSlcblxuXHRcdHJldHVybiAoXG5cdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cImNoYXJ0LWJveFwiPlxuXHRcdFx0XHQ8TGluZSBkYXRhPXtkYXRhfSBvcHRpb25zPXtvcHRzfSAvPlxuXHRcdFx0PC9kaXY+XG5cdFx0KVxuXHR9XG5cblx0cHJpdmF0ZSBnZXQgZGF0YSgpOiBDaGFydERhdGEge1xuXHRcdGNvbnN0IGxhYmVsczogc3RyaW5nW10gPSBbXVxuXG5cdFx0bGV0IGRhdGFzZXRzOiBDaGFydERhdGFTZXRzW10gPSBbXG5cdFx0XHR7IGxhYmVsOiAndmlld3MnLCAgICAgYm9yZGVyQ29sb3I6ICcjNzc3JywgfSxcblx0XHRcdHsgbGFiZWw6ICdkaXNsaWtlcycsICBib3JkZXJDb2xvcjogJyM5OTknLCB9LFxuXHRcdFx0eyBsYWJlbDogJ2xpa2VzJywgICAgIGJvcmRlckNvbG9yOiAnI2JiYicsIH0sXG5cdFx0XHR7IGxhYmVsOiAnY29tbWVudHMnLCAgYm9yZGVyQ29sb3I6ICcjNTU1JywgfSxcblx0XHRcdHsgbGFiZWw6ICdmYXZvcml0ZXMnLCBib3JkZXJDb2xvcjogJyMzMzMnLCB9LFxuXHRcdF1cblxuXHRcdGRhdGFzZXRzID0gZGF0YXNldHMubWFwKGRhdGFzZXQgPT4ge1xuXHRcdFx0ZGF0YXNldC5iYWNrZ3JvdW5kQ29sb3IgPSBkYXRhc2V0LmJhY2tncm91bmRDb2xvciB8fCBkYXRhc2V0LmJvcmRlckNvbG9yXG5cdFx0XHRkYXRhc2V0LmRhdGEgPSBbXVxuXHRcdFx0ZGF0YXNldC5wb2ludFJhZGl1cyA9IDFcblxuXHRcdFx0cmV0dXJuIGRhdGFzZXRcblx0XHR9KVxuXG5cdFx0bGV0IGNvdW50ID0gMFxuXG5cdFx0dGhpcy5wcm9wcy5zbmFwc2hvdHMuZm9yRWFjaChzbmFwc2hvdCA9PiB7XG5cdFx0XHRsYWJlbHMucHVzaChgJHtjb3VudCsrfWApXG5cdFx0XHRcblx0XHRcdGRhdGFzZXRzLmZvckVhY2goKHsgbGFiZWw9J1tFUlJPUl0nLCBkYXRhPVtdIH0pID0+IHtcblx0XHRcdFx0KGRhdGEgYXMgbnVtYmVyW10pLnB1c2goTnVtYmVyKHNuYXBzaG90W2xhYmVsXSkpXG5cdFx0XHR9KVxuXHRcdH0pXG5cblx0XHRjb25zdCBtYXhDb3VudCA9IDFcblxuXHRcdHJldHVybiB7IGxhYmVscywgZGF0YXNldHMgfVxuXHR9XG59XG5cblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlRnJhZ21lbnRDb250YWluZXIoU3RhdHNDaGFydCwgZ3JhcGhxbGBcblx0ZnJhZ21lbnQgU3RhdHNDaGFydF9zbmFwc2hvdHMgb24gVmlkZW9TdGF0cyBAcmVsYXkocGx1cmFsOiB0cnVlKSB7XG5cdFx0dmlld3Ncblx0XHRsaWtlc1xuXHRcdGRpc2xpa2VzXG5cdFx0ZmF2b3JpdGVzXG5cdFx0Y29tbWVudHNcblx0fVxuYClcbiJdfQ==